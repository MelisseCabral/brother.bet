{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Scrapper from './Scrapper';\nimport FactoryFifaArena from './FactoryFifaArena';\n\nconst Database = require('@brother.bet/Database');\n\nconst Api = require('@brother.bet/Api');\n\nconst Util = require('@brother.bet/Util');\n\nexport default class ServiceFifaArena {\n  constructor() {\n    this.baseUrl = 'https://brother.bet';\n    this.getDatesSearch = getDatesSearch();\n  }\n\n  static async updateFifaArena() {\n    try {\n      const {\n        lastDay,\n        dateQuery\n      } = this.getDatesSearch();\n      const contentHTML = await Scrapper.getPageHTML('http://stats.cyberarena.live/results.aspx?tab=fifa21', dateQuery);\n      const data = await FactoryFifaArena.getGamesResult(contentHTML);\n      const api = new Api('https://brother.bet').api;\n      const database = new Database(api);\n      const obj = [{\n        date: dateQuery,\n        data: data,\n        id: 'noUniqueId'\n      }];\n      await database.setData('2021', obj).then(resp => {\n        return {\n          message: `Dados de ${lastDay} atualizados com sucesso.`,\n          code: 200\n        };\n      }).catch(error => {\n        return {\n          data: _objectSpread({\n            message: 'Estamos com indisponibilidade no momento, tente novamente mais tarde!'\n          }, error),\n          code: 500\n        };\n      });\n    } catch (error) {\n      return {\n        data: _objectSpread({\n          message: 'Estamos com indisponibilidade no momento, tente novamente mais tarde!'\n        }, error),\n        code: 500\n      };\n    }\n  }\n\n  async getDatabase(initDate) {\n    try {\n      const year = Util.getToday().split('-')[0];\n      const availableDays = this.robot.getAvailableDays('', year, initDate);\n      const database = await this.robot.mountDatabase(availableDays);\n      return database;\n    } catch (error) {\n      console.log(error);\n      console.log('Error in getDatabase.');\n      await this.delay();\n      return this.getDatabase(initDate);\n    }\n  }\n\n  static getDatesSearch() {\n    const date = new Date();\n    date.setDate(date.getDate() - 1);\n    const lastDay = `${date.getFullYear()}.${`0${date.getMonth() + 1}`.slice(-2)}.${`0${date.getDate()}`.slice(-2)}`;\n    const dateQuery = `${date.getFullYear()}-${`0${date.getMonth() + 1}`.slice(-2)}-${`0${date.getDate()}`.slice(-2)}`;\n    return {\n      lastDay: lastDay,\n      dateQuery: dateQuery\n    };\n  }\n\n}","map":{"version":3,"sources":["/Users/mel/Desktop/brother.bet/packages/web/src/pages/api/BotFifaArena/ServiceFifaArena.js"],"names":["Scrapper","FactoryFifaArena","Database","require","Api","Util","ServiceFifaArena","constructor","baseUrl","getDatesSearch","updateFifaArena","lastDay","dateQuery","contentHTML","getPageHTML","data","getGamesResult","api","database","obj","date","id","setData","then","resp","message","code","catch","error","getDatabase","initDate","year","getToday","split","availableDays","robot","getAvailableDays","mountDatabase","console","log","delay","Date","setDate","getDate","getFullYear","getMonth","slice"],"mappings":"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","sourcesContent":["import Scrapper from './Scrapper'\nimport FactoryFifaArena from './FactoryFifaArena'\nconst Database = require('@brother.bet/Database')\nconst Api = require('@brother.bet/Api')\nconst Util = require('@brother.bet/Util')\n\nexport default class ServiceFifaArena {\n  constructor() {\n    this.baseUrl = 'https://brother.bet'\n    this.getDatesSearch = getDatesSearch()\n  }\n\n  static async updateFifaArena() {\n    try {\n      const { lastDay, dateQuery } = this.getDatesSearch()\n\n      const contentHTML = await Scrapper.getPageHTML(\n        'http://stats.cyberarena.live/results.aspx?tab=fifa21',\n        dateQuery\n      )\n      const data = await FactoryFifaArena.getGamesResult(contentHTML)\n      const api = new Api('https://brother.bet').api\n      const database = new Database(api)\n\n      const obj = [{ date: dateQuery, data: data, id: 'noUniqueId' }]\n      await database\n        .setData('2021', obj)\n        .then((resp) => {\n          return { message: `Dados de ${lastDay} atualizados com sucesso.`, code: 200 }\n        })\n        .catch((error) => {\n          return {\n            data: {\n              message: 'Estamos com indisponibilidade no momento, tente novamente mais tarde!',\n              ...error,\n            },\n            code: 500,\n          }\n        })\n    } catch (error) {\n      return {\n        data: {\n          message: 'Estamos com indisponibilidade no momento, tente novamente mais tarde!',\n          ...error,\n        },\n        code: 500,\n      }\n    }\n  }\n\n  async getDatabase(initDate) {\n    try {\n      const year = Util.getToday().split('-')[0]\n      const availableDays = this.robot.getAvailableDays('', year, initDate)\n      const database = await this.robot.mountDatabase(availableDays)\n      return database\n    } catch (error) {\n      console.log(error)\n      console.log('Error in getDatabase.')\n      await this.delay()\n      return this.getDatabase(initDate)\n    }\n  }\n\n  static getDatesSearch() {\n    const date = new Date()\n    date.setDate(date.getDate() - 1)\n    const lastDay = `${date.getFullYear()}.${`0${date.getMonth() + 1}`.slice(\n      -2\n    )}.${`0${date.getDate()}`.slice(-2)}`\n    const dateQuery = `${date.getFullYear()}-${`0${date.getMonth() + 1}`.slice(\n      -2\n    )}-${`0${date.getDate()}`.slice(-2)}`\n\n    return { lastDay: lastDay, dateQuery: dateQuery }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}